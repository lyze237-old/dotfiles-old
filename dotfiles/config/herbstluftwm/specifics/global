#!/usr/bin/env bash


if hc silent ! get_attr my_not_first_autostart ; then
    # rules
    hc unrule -F

    hc rule focus=on # normally focus new clients
    hc rule windowtype~'_NET_WM_WINDOW_TYPE_(DIALOG|UTILITY|SPLASH)' pseudotile=on
    hc rule windowtype='_NET_WM_WINDOW_TYPE_DIALOG' focus=on hook=FLOAT_DIALOG monitor=$floatingMonitorName tag=$floatingTagName
    hc rule windowtype~'_NET_WM_WINDOW_TYPE_(NOTIFICATION|DOCK|DESKTOP)' manage=off

    # fix popup
    # hc rule windowtype~'_NET_WM_WINDOW_TYPE_(DIALOG|UTILITY|SPLASH)' manage=off focus=on
    # hc rule windowtype~'_NET_WM_WINDOW_TYPE_(NOTIFICATION|DOCK)' manage=off focus=off
fi

function setupListeners() {
    echo "-------------------------              setup listeners"
    hc -i |
    while read -r line ; do
        if [[ "$line" = *"FLOAT_DIALOG"* ]] ; then
            client="$(echo $line | cut -d ' ' -f3)"
            echo setting $client to floating
            hc chain . \
                chain try new_attr string clients.$client.my_lastmon \
                    try true \
                . substitute M monitors.focus.index \
                    set attr clients.$client.my_lastmon M 
        fi
    done
} 

echo "-----------------<>"
setupListeners &
